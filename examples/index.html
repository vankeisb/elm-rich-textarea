<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>elm-rich-textarea</title>
    <script src="elm.js"></script>
    <style type="text/css">
        /* make it look like a default textarea (optional) */
        /*body {*/
        /*font-family: monospace*/
        /*}*/
    </style>
</head>
<body>
<div id="app"></div>
<script>
    const app = Elm.Main.init({node: document.getElementById("app")});

    // wire parsing ports !
    app.ports.requestHighlight.subscribe(highlightRequest => {
        const styles = highlight(highlightRequest);
        app.ports.responseHighlight.send(
            styles
        );
    });


    // here below is the dumbest highlighter ever...

    function highlight(str) {
        return highlightWords(str, [ "let", "in" ], "Keyword").concat(
            highlightWords(str, [ "foo", "bar" ], "Identifier")
        );
    }

    function highlightWords(str, words, style) {
        return words.map(k => highlightWord(0, str, k, style)).flat();
    }

    function highlightWord(index, str, word, style) {
        const i = str.indexOf(word);
        if (i === -1) {
            return [];
        } else {
            const rest = str.substring(i + word.length);
            return [
                {
                    "range": [
                        index + i,
                        index + i + word.length
                    ],
                    "mystyle": style
                }
            ].concat(
                highlightWord(index + i + word.length, rest, word, style)
            );
        }
    }



</script>
</body>
</html>